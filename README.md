# Next.js Interface for the [Laravel Next Headless CMS](https://github.com/cima-alfa/next-laravel-cms-api)

## Developer Docs:

-   Read the Next.js 15 docs to see what is required for development ([Next.js Docs](https://nextjs.org/docs))
-   Install the API CMS repository - [Repo Here](https://github.com/cima-alfa/next-laravel-cms-api)
    -   For now, both repositories must be installed in the same directory
-   Duplicate the `env.local.example` file and rename it to `env.local`
    -   Configure the application URLs
    -   Configure fetch delay simulation
        -   `null` means the simulation will execute if in dev mode
        -   `true` means the simulation will allways execute
        -   `false` means the simulation will never execute
-   Do the following:
    -   Run `pnpm install` or `npm install`
    -   Run `pnpm dev` or `npm run dev`
-   Default hosts for frontend and api are `localhost:3000` and `localhost:8000` respectively

### App Router

The frontend / public area can be found in `src/app/(front)`.

The backend / control panel can be found in `src/app/(back)`.

#### Sitemap / Robots.txt

Both are autogenerated by Next.js with data provided by the CMS.

Should you need the modify them, the appropiate files are in `src/app/sitemap.ts` and `src/app/robots.ts`.

---

### UI

Both the frontend and backend have separate UI files found in `src/ui/_front` and `src/ui/_back` respectively.

Shared components are in `src/ui/components`.

Favicons must be included in the `src/app` directory. For more information, checkout the [Favicon Next.js docs](https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons).

---

### Helpers and Hooks

#### Object helpers (`@cms/helpers`)

The following multidimensional object helpers are available:

-   ##### `setObject(object: object, path: string, value: unknown)`

    Allows to set a mutidimensional element in the provided object usin the dot notation.

    If we provide an empty object and set a value of `Hello there!` to the `foo.bar` path, then the updated object is returned:

    `{ foo: { bar: "Hello there!" } }`

&nbsp;

-   ##### `findInObject(object: object, path: string)`

    Allows to find a mutidimensional element in the provided object usin the dot notation.

    If we have the following object: `{ foo: { bar: "Hello there!" } }` and provide the following path: `foo.bar`, then the `Hello there!` value is returned.

    If the path is incorrect, `undefined` is returned.

#### UI Hooks (`@cms/hooks`)

-   ##### `useWindowSize()`

    Returns the inner window size. Values are updated on resize.

    ```
    {
        width: number | undefined,
        height: number | undefined
    }
    ```

-   ##### `useSetSourceMedia(...pictures: React.RefObject<HTMLPictureElement | null>[])`

    Accepts React Refs of `<picture />` elements that contain images that should change depending on the current theme (dark or light).

    Automatically changes the image if the theme is manually toggled.

---

### Router (`@cms/router`)

App URLs defined in the `.env.local` config are exported as `ApiUrl` and `FrontUrl` constants.

#### Links

-   ##### `link(name: RouteName, params?: { [key: string]: unknown } | URLSearchParams, absolute = false)`

    Generates a front url (relative by default) from a route name. The route names are defined in the `RouteName` type.

    Accepts a `params` parameter, can be either a simple or `URLSearchParams` object. Params are either included as route segments or URL query, depending on the route definition.

    If a param is required and not included, an exception is thrown.

    For example, the link for the route `/users/{userId}` with `{ userId: 'random-id', only: 'first-name' }` params would look like this: `/users/random-id?only=first-name`

-   ##### `permalink(page: Page, params?: { [key: string]: unknown } | URLSearchParams, absolute = false)`

    Helper to generate a page permalink (relative by default). Works the same as the `link` function, but instead of a route name, it accepts a `Page` object.

-   ##### `linkApi(name: RouteName, params?: { [key: string]: unknown } | URLSearchParams)`

    Same as `link` except it generates API URLs, always absolute.

-   ##### `searchParamsToObject(searchParams: URLSearchParams)`

    Helper to convert `URLSearchParams` to a simple object.

#### Routes

-   ##### `type Route`

    ```
    {
        name: RouteName;
        data: {
            uri: string;
            pattern: string;
            methods: string[];
            parameters?: string[];
            wheres?: {
                [key: string]: string;
            };
            middleware?: string[];
            [key: string]: unknown;
        };
        pattern: URLPattern;
        segments?: RouteSegments;
    }
    ```

-   ##### `getRoutes()`

    Gets all front routes. Returns `Route[]`.

    This can also be accessed from the exported `routes` constant.

-   ##### `getRoute(name: RouteName)`

    Gets a front route by name. Returns `Route`.

-   ##### `routeExists(name: RouteName)`

    Checks if a front route exists by name and returns `bool`.

-   ##### `getRouteByUrl(url: string)`

    Gets a front route from a url string (can be relative or absolute). Returns `Route | null`.

---

### Fetch (`@cms/fetch`)

Server only fetching. Automatically sets headers neccessary for correct communication between the frontend and API, such as: Content Type and AJAX headers, XSRF Token, Correct IP and User Agent and Cookies.

Because it's a server to server communication (the Next.js server acts as a proxy), the IP and User Agent need to be set manually. Otherwise the API will receive the IP and User Agent of the Next.js server instead of the client.
